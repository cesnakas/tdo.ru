$(document).ready(function () {


    $('.text-block__show-more').on('click', function () {
        $(this).parents('.text-block').addClass('text-block__more')
        $('.text-block__hidden').slideDown();
    });

    $('.text-block__hidden-more').on('click', function () {

        $('.text-block__hidden').slideUp();
        $(this).parents('.text-block').removeClass('text-block__more')
    })

    $('.main-screen-content__slider').slick({
        slidesToShow: 1,
        arrows: false,
        fade: true,
        autoplay: true,
        dots: true,
        dotsClass: 'slider-dots',
        asNavFor: '.main-screen-content__thumbnails',

    });


    $('.main-screen-content__thumbnails').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        asNavFor: '.main-screen-content__slider',
        dots: false,
        fade: true,
        arrows: false,
        focusOnSelect: true
    });

    $('.good-popup_wrap-radio').on('click', function () {
        $('.good_radio_img').removeClass('good_radio_img--active');
        $(this).find('.good_radio_img').addClass('good_radio_img--active');

    });


    $(window).resize(function () {
        blogSliderHeight = $('.blog-slider').height();
        if (window.matchMedia("(max-width: 768px)").matches) {
            $('.blog-slider .slick-next').css('top', blogSliderHeight);
            $('.blog-slider-768-shadow').css('height', blogSliderHeight);

        } else {
            $('.blog-slider-768-shadow').css('display', 'none');
        }
    });

    $('.sort-wrap .sort_filter-check_wrap .checkbox-custom-hidd').on('click', function () {
        if ($(this).prop("checked")) {
            $('.sort_filter-check_wrap').removeClass('sort_filter-check_wrap--active');
            $(this).closest('.sort_filter-check_wrap').addClass('sort_filter-check_wrap--active');

        } else {
            $(this).closest('.sort_filter-check_wrap').removeClass('sort_filter-check_wrap--active');
        }
    });

    var numStatus = 20 * $('.good-page_rating_right-status-line-long span').text();

    $('.good-page_rating_right-status-line-long').css('width', numStatus + '%');

    $('.region-select').styler();
    $('.sort-select').styler({
        onFormStyled: function () {
            console.log('onFormStyled');
            $('.sort-select-wrap').css('visibility', 'visible');
        }
    });

    $('.clear-input').on('click', function () {
        $(this).next('.input').val('').parent('.wrap-input').removeClass('wrap-input--active');
    });


    $('.good-page_slider').slick({
        slidesToShow: 1,
        arrows: true,
        asNavFor: '.good-page_slider-nav',

    });

    $('.good-page_slider-nav').slick({
        slidesToShow: 4,
        vertical: true,
        arrows: false,
        verticalSwiping: true,
        asNavFor: '.good-page_slider',
        focusOnSelect: true,
        responsive: [
            {
                breakpoint: 1139,
                settings: {
                    vertical: false,
                    verticalSwiping: false,
                    slidesToShow: 4,
                }
            },
            {
                breakpoint: 372,
                settings: {
                    vertical: false,
                    verticalSwiping: false,
                    slidesToShow: 3,
                }
            },
        ]
    });

    $('.inner-blog-slider').slick({
        slidesToShow: 2,
        arrows: false,
        autoplay: true,
        responsive: [
            {
                breakpoint: 584,
                settings: {
                    slidesToShow: 1,
                }
            }
        ]
    });
    $('.goods-slider').slick({
        slidesToShow: 4,
        responsive: [
            {
                breakpoint: 1053,
                settings: {
                    slidesToShow: 4,
                }
            },
            {
                breakpoint: 763,
                settings: {
                    slidesToShow: 3,
                }
            },
            {
                breakpoint: 585,
                settings: {
                    slidesToShow: 2,
                }
            },
            {
                breakpoint: 399,
                settings: {
                    slidesToShow: 1,
                }
            },
        ]
    });


    $('.radio-hid:checked').parents('.good-popup_wrap-radio').addClass('class_name');
    var countActivate = 0;
    $('#good-popup-btn').fancybox({
        touch: false,
    });
    $('#addCart-popup-btn').fancybox({
        touch: false,
        onInit: function (instance, current) {
            if (countActivate === 0) {
                $('.goods-slider-var-popup').slick({
                    slidesToShow: 4,
                    infinite: false,
                    responsive: [
                        {
                            breakpoint: 740,
                            settings: {
                                slidesToShow: 3,
                            }
                        },
                        {
                            breakpoint: 458,
                            settings: {
                                slidesToShow: 2,
                            }
                        },
                    ]
                });
            }
            countActivate += 1;

        }

    })

    $('#goods-slider-var, #goods-slider-var-2').slick({
        slidesToShow: 4,
        responsive: [
            {
                breakpoint: 1053,
                settings: {
                    slidesToShow: 4,
                }
            },
            {
                breakpoint: 893,
                settings: {
                    slidesToShow: 3,
                }
            },
            {
                breakpoint: 683,
                settings: {
                    slidesToShow: 2,
                }
            },
            {
                breakpoint: 490,
                settings: {
                    slidesToShow: 1,
                }
            },
        ]
    });


    $('.video-slider-wrap').slick({
        slidesToShow: 4,
        responsive: [
            {
                breakpoint: 1221,
                settings: {
                    slidesToShow: 4,
                }
            },
            {
                breakpoint: 519,
                settings: {
                    slidesToShow: 3,
                }
            },

        ]
    });

    $('.call-us-slider').slick({
        slidesToShow: 1,
        autoplay: true
    })
    $('.blog-slider').slick({
        slidesToShow: 4,
        responsive: [
            {
                breakpoint: 820,
                settings: {
                    slidesToShow: 3,
                }
            },
            {
                breakpoint: 585,
                settings: {
                    slidesToShow: 2,

                }
            },


        ]
    });


    $('.sale-slider-container').slick({
        slidesToShow: 1,
        dots: true

    });

    $('.main-news-slider').slick({
        slidesToShow: 2,
        arrows: false,
        autoplay: true,

        responsive: [
            {
                breakpoint: 1053,
                settings: {
                    slidesToShow: 1,
                }
            },
        ]

    })

    $('.big-form').on('focus', '.input', function () {
        $(this).parent('.wrap-input').addClass('wrap-input--active');
    });

    $('.big-form').on('focusout', '.input', function () {

        if ($(this).val().length == 0) {
            $(this).parent('.wrap-input').removeClass('wrap-input--active');
        }

    });

    $('.burger').on('click', function () {
        $('.menu-mask').addClass('menu-mask_active');
        $('body').addClass('body-active');
    });

    $('.close-menu-mask').on('click', function () {
        $('.menu-mask').removeClass('menu-mask_active');
        $('body').removeClass('body-active');
    });

    $('.cat-btn').on('click', function () {
        $('.header-bottom-main-screen').toggleClass('header-bottom-main-screen--active');
        $('.catalog-mask_wrap').toggleClass('catalog-mask--active');
        $('body').toggleClass('body-active');
        $(this).toggleClass('cat-btn--active');
    });

    $('.catalog-left-item').on('click', function () {
        if (window.matchMedia("(max-width: 750px)").matches) {
            $('.catalog-left-item').removeClass('catalog-left-item--active');
            $(this).addClass('catalog-left-item--active');
            $('.catalog-left-item_dropdown').slideUp(300);
            $(this).children('.catalog-left-item_dropdown').slideDown(300);
        }
    });

    $('.catalog-mask-close').on('click', function () {
        $('body').removeClass('body-active');
        $('.catalog-mask_wrap').removeClass('catalog-mask--active');
        $('.cat-btn').removeClass('cat-btn--active');
        $('.header-bottom-main-screen').removeClass('header-bottom-main-screen--active');
    });


	$('#show-filter_btn-js').on('click', function () {
		$('#sort-filter-js').show();
		$('body').addClass('fix');
    });

	$('#sort-close').on('click', function () {
		$('#sort-filter-js').hide();
		$('body').removeClass('fix');
    });


    // $(window).scroll(function(){
    // 	var scrtollY = $(this).scrollTop();
    // 	console.log(scrtollY);
    // 	if (scrtollY > 1000) {
    // 		$('.header-bottom').addClass('header-bottom-scroll')
    // 	}else{
    // 		$('.header-bottom').removeClass('header-bottom-scroll')
    // 	}

    // });

    var blogSliderHeight = $('.blog-slider').height();
    if (window.matchMedia("(max-width: 768px)").matches) {
        blogSliderHeight = $('.blog-slider').height();
        $('.blog-slider .slick-next').css('top', blogSliderHeight);
        $('.blog-slider-wrap:after').css('height', blogSliderHeight);
        $('.blog-slider-768-shadow').css('height', blogSliderHeight);
        console.log(blogSliderHeight);
    } else {
        $('.blog-slider-768-shadow').css('display', 'none');
    }


    /*	$(window).scroll(function(event) {
            var headerHeight = $('header').height();
            if($(window).scrollTop() >= headerHeight){
                $('header').addClass('header-fixed');
                $('.header-bottom').addClass('header-bottom-inner');
                $('body').css('padding-top', headerHeight + 'px')
            }else{
                $('header').removeClass('header-fixed');
                $('body').css('padding-top', 0)
                if($('.header-bottom').hasClass('header-bottom-main-screen')){
                    $('.header-bottom').removeClass('header-bottom-inner');
                }

            }
        });*/

    $('.main-sample-slider.bonmar').slick({
        asNavFor: '.thumb-sample-slider.bonmar',
        slidesToShow: 1,
        slidesToScroll: 1,
        infinite: false,
        arrows: true,
        appendArrows: $('.sample-slider-arrows-container.bonmar'),
        prevArrow: "<button type='button' class='slick-prev pull-left'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/left-chevron.png'></button>",
        nextArrow: "<button type='button' class='slick-next pull-right'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/right-chevron.png'></button>",
    });

    $('.thumb-sample-slider.bonmar').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: false,
        asNavFor: '.main-sample-slider.bonmar',
        focusOnSelect: true,
        arrows: false,
        responsive: [
            {
                breakpoint: 992,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                }
            },
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 500,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 360,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            }
        ]
    });
    
    $('.main-sample-slider.chicago').slick({
        asNavFor: '.thumb-sample-slider.chicago',
        slidesToShow: 1,
        slidesToScroll: 1,
        infinite: false,
        arrows: true,
        appendArrows: $('.sample-slider-arrows-container.chicago'),
        prevArrow: "<button type='button' class='slick-prev pull-left'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/left-chevron.png'></button>",
        nextArrow: "<button type='button' class='slick-next pull-right'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/right-chevron.png'></button>",
    });

    $('.thumb-sample-slider.chicago').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: false,
        asNavFor: '.main-sample-slider.chicago',
        focusOnSelect: true,
        arrows: false,
        responsive: [
            {
                breakpoint: 992,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                }
            },
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 500,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 360,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            }
        ]
    });

    $('.main-sample-slider.tp01').slick({
        asNavFor: '.thumb-sample-slider.tp01',
        slidesToShow: 1,
        slidesToScroll: 1,
        infinite: false,
        arrows: true,
        appendArrows: $('.sample-slider-arrows-container.tp01'),
        prevArrow: "<button type='button' class='slick-prev pull-left'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/left-chevron.png'></button>",
        nextArrow: "<button type='button' class='slick-next pull-right'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/right-chevron.png'></button>",
    });

    $('.thumb-sample-slider.tp01').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: false,
        asNavFor: '.main-sample-slider.tp01',
        focusOnSelect: true,
        arrows: false,
        responsive: [
            {
                breakpoint: 992,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                }
            },
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 500,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 360,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            }
        ]
    });

    $('.main-sample-slider.tp02').slick({
        asNavFor: '.thumb-sample-slider.tp02',
        slidesToShow: 1,
        slidesToScroll: 1,
        infinite: false,
        arrows: true,
        appendArrows: $('.sample-slider-arrows-container.tp02'),
        prevArrow: "<button type='button' class='slick-prev pull-left'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/left-chevron.png'></button>",
        nextArrow: "<button type='button' class='slick-next pull-right'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/right-chevron.png'></button>",
    });

    $('.thumb-sample-slider.tp02').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: false,
        asNavFor: '.main-sample-slider.tp02',
        focusOnSelect: true,
        arrows: false,
        responsive: [
            {
                breakpoint: 992,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                }
            },
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 500,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 360,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            }
        ]
    });

    $('.main-sample-slider.tp03').slick({
        asNavFor: '.thumb-sample-slider.tp03',
        slidesToShow: 1,
        slidesToScroll: 1,
        infinite: false,
        arrows: true,
        appendArrows: $('.sample-slider-arrows-container.tp03'),
        prevArrow: "<button type='button' class='slick-prev pull-left'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/left-chevron.png'></button>",
        nextArrow: "<button type='button' class='slick-next pull-right'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/right-chevron.png'></button>",
    });

    $('.thumb-sample-slider.tp03').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: false,
        asNavFor: '.main-sample-slider.tp03',
        focusOnSelect: true,
        arrows: false,
        responsive: [
            {
                breakpoint: 992,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                }
            },
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 500,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 360,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            }
        ]
    });

    $('.main-sample-slider.tp04').slick({
        asNavFor: '.thumb-sample-slider.tp04',
        slidesToShow: 1,
        slidesToScroll: 1,
        infinite: false,
        arrows: true,
        appendArrows: $('.sample-slider-arrows-container.tp04'),
        prevArrow: "<button type='button' class='slick-prev pull-left'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/left-chevron.png'></button>",
        nextArrow: "<button type='button' class='slick-next pull-right'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/right-chevron.png'></button>",
    });

    $('.thumb-sample-slider.tp04').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: false,
        asNavFor: '.main-sample-slider.tp04',
        focusOnSelect: true,
        arrows: false,
        responsive: [
            {
                breakpoint: 992,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                }
            },
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 500,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 360,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            }
        ]
    });

    $('.main-sample-slider.tp05').slick({
        asNavFor: '.thumb-sample-slider.tp05',
        slidesToShow: 1,
        slidesToScroll: 1,
        infinite: false,
        arrows: true,
        appendArrows: $('.sample-slider-arrows-container.tp05'),
        prevArrow: "<button type='button' class='slick-prev pull-left'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/left-chevron.png'></button>",
        nextArrow: "<button type='button' class='slick-next pull-right'><img src='/local/templates/tdo_shop/img/serv_images/engineering_and_design/right-chevron.png'></button>",
    });

    $('.thumb-sample-slider.tp05').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        infinite: false,
        asNavFor: '.main-sample-slider.tp05',
        focusOnSelect: true,
        arrows: false,
        responsive: [
            {
                breakpoint: 992,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                }
            },
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 500,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: false,
                    infinite: true,
                }
            },
            {
                breakpoint: 360,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    infinite: true,
                }
            }
        ]
    });

    $('.fancybox').fancybox();
});

jQuery.cookie = function (name, value, options) {
    if (typeof value != 'undefined') { // name and value given, set cookie
        options = options || {};
        if (value === null) {
            value = '';
            options.expires = -1;
        }
        var expires = '';
        if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
            var date;
            if (typeof options.expires == 'number') {
                date = new Date();
                date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
            } else {
                date = options.expires;
            }
            expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE
        }
        // CAUTION: Needed to parenthesize options.path and options.domain
        // in the following expressions, otherwise they evaluate to undefined
        // in the packed version for some reason...
        var path = options.path ? '; path=' + (options.path) : '';
        var domain = options.domain ? '; domain=' + (options.domain) : '';
        var secure = options.secure ? '; secure' : '';
        document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
    } else { // only name given, get cookie
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
};




jQuery(function () {
    jQuery('.js-pay-one-click-form').validate({
        rules: {
            username: {
                required: true,
                minlength: 3
            },
            phone: {
                required: true,
            },
            agree: {
                required: true,
            },
        },
        messages: {
            username: {
                required: "Укажите имя",
                minlength: "Имя должно быть более 3-х символов"
            },
            phone: {
                required: "Укажите телефон",
            },
            agree: {
                required: "Согласитесь с условиями",
            },
        },
        submitHandler: function (form) {
            jQuery(form).ajaxSubmit({
                data: {'act': 'buyOneClick'},
                dataType: 'json',
                resetForm: false,
                success: function (mess) {
                    var title = '';
                    var html = '';

                    if (mess['SUCCESS'] == 'Y') {
                        $.fancybox.close();
                        jQuery('.js-pay-one-click-form').resetForm();
                    }

                    alert(mess['MESS']);
                }
            });
        }
    });
});



jQuery(function () {
    jQuery('.js-pay-click-form').validate({
        rules: {
            username: {
                required: true,
                minlength: 3
            },
            phone: {
                required: true,
            },
            agree: {
                required: true,
            },
        },
        messages: {
            username: {
                required: "Укажите имя",
                minlength: "Имя должно быть более 3-х символов"
            },
            phone: {
                required: "Укажите телефон",
            },
            agree: {
                required: "Согласитесь с условиями",
            },
        },
        submitHandler: function (form) {
            jQuery(form).ajaxSubmit({
                data: {'act': 'buyUnderOrder'},
                dataType: 'json',
                resetForm: false,
                success: function (mess) {
                    var title = '';
                    var html = '';

                    if (mess['SUCCESS'] == 'Y') {
                        $.fancybox.close();
                        jQuery('.js-pay-click-form').resetForm();
                    }

                    alert(mess['MESS']);
                }
            });
        }
    });
});



jQuery(function () {
    jQuery('.js-pay-credit-form').validate({
        rules: {
            username: {
                required: true,
                minlength: 3
            },
            phone: {
                required: true,
            },
            agree: {
                required: true,
            },
        },
        messages: {
            username: {
                required: "Укажите имя",
                minlength: "Имя должно быть более 3-х символов"
            },
            phone: {
                required: "Укажите телефон",
            },
            agree: {
                required: "Согласитесь с условиями",
            },
        },
        submitHandler: function (form) {
            jQuery(form).ajaxSubmit({
                data: {'act': 'buyСredit'},
                dataType: 'json',
                resetForm: false,
                success: function (mess) {
                    var title = '';
                    var html = '';

                    if (mess['SUCCESS'] == 'Y') {
                        $.fancybox.close();
                        jQuery('.js-pay-credit-form').resetForm();
                    }

                    alert(mess['MESS']);
                }
            });
        }
    });
});

jQuery(function () {
    jQuery(document).ready(function ($) {
        var $forms = jQuery('.js-pay-under-order-form');
        jQuery.each($forms, function (i, val) {
            var $form = $forms.eq(i);

            $form.validate({
                rules: {
                    username: {
                        required: true,
                        minlength: 3
                    },
                    phone: {
                        required: true,
                    },
                    agree: {
                        required: true,
                    },
                },
                messages: {
                    username: {
                        required: "Укажите имя",
                        minlength: "Имя должно быть более 3-х символов"
                    },
                    phone: {
                        required: "Укажите телефон",
                    },
                    agree: {
                        required: "Согласитесь с условиями",
                    },
                },
                submitHandler: function (form) {
                    jQuery(form).ajaxSubmit({
                        data: {'act': 'buyUnderOrder'},
                        dataType: 'json',
                        resetForm: false,
                        success: function (mess) {
                            var title = '';
                            var html = '';

                            if (mess['SUCCESS'] == 'Y') {
                                $.fancybox.close();
                                jQuery('.js-pay-under-order-form').resetForm();
                            }

                            alert(mess['MESS']);
                        }
                    });
                }
            });
        });
    });
});


function showPopupCart(pid, img, quantity) {
    quantity = quantity || 0;

    jQuery.ajax({
        url: '/ajax/ajax.php?act=addToBasket',
        type: 'post',
        data: 'id=' + pid + '&quantity=' + quantity,
        dataType: 'json',
        beforeSend: function () {
            // $('#sendajax').button('loading');
        },
        complete: function () {
            // $('#sendajax').button('reset');
        },
        success: function (json) {
            if (json.SUCCESS != 'Y') {
                alert(json.MESS);
            }

            var $wrap = jQuery('#addCart-popup');
            var data = json.DATA;

            $wrap.find('.js-totalQuantity').html(data.totalQuantity);
            $wrap.find('.js-totalBasket').html(data.totalBasket);
            $wrap.find('.js-totalItem').html(data.totalItem);
            $wrap.find('.js-name').html(data.name);
            $wrap.find('.js-quantity').val(data.quantity);

            if (img) {
                $wrap.find('.js-img').css('background-image', 'url(' + img + ')');
            }

            if ($('.fancybox-content').length == 0) {
                $.fancybox.open({
                    src: '#addCart-popup',
                    touch: false,
                    opts: {
                        afterShow: function (instance, current) {
                            if (!$('.goods-slider-var-popup').hasClass('slick-initialized')) {
                                $('.goods-slider-var-popup').slick({
                                    slidesToShow: 4,
                                    infinite: false,
                                    responsive: [
                                        {
                                            breakpoint: 740,
                                            settings: {
                                                slidesToShow: 3,
                                            }
                                        },
                                        {
                                            breakpoint: 458,
                                            settings: {
                                                slidesToShow: 2,
                                            }
                                        },
                                    ]
                                });
                            }
                        }
                    }
                });
            }

        },
        error: function (xhr, ajaxOptions, thrownError) {
            // alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
}

jQuery(function ($) {

    jQuery(document).on('click', '.js-add-to-cart-popup', function (e) {
        e.preventDefault();

        var pid = jQuery(this).data('pid');
        var img = jQuery(this).data('img');
        var quantityDiff = jQuery(this).data('quantity');

        if (!pid) {
            return false;
        }

        var $wrap = jQuery('#addCart-popup');
        var quantity = $wrap.find('.js-quantity').val();

        quantity = Number(quantity);

        var newQuantity = quantity + Number(quantityDiff);
        if (newQuantity < 1) {
            newQuantity = 1;
        }

        if (newQuantity == quantity) {
            return false;
        }

        $wrap.find('.js-quantity').val(newQuantity);

        showPopupCart(pid, img, newQuantity);


    });

    jQuery(document).on('click', '.js-add-to-cart', function (e) {
        e.preventDefault();

        var pid = jQuery(this).data('pid');
        var img = jQuery(this).data('img');
        if (!pid) {
            return false;
        }

        jQuery('.js-add-to-cart-popup').data('pid', pid);
        jQuery('.js-add-to-cart-popup').data('img', img);

        jQuery.ajax({
            // url: '/',
            type: 'post',
            data: 'ajax_basket=Y&prop[0]=0&action=ADD2BASKET&id=' + pid,
            dataType: 'json',
            beforeSend: function () {
                // $('#sendajax').button('loading');
            },
            complete: function () {
                // $('#sendajax').button('reset');
            },
            success: function (json) {
                if (json.STATUS != 'OK') {
                    alert(json.MESSAGE);
                }

                BX.onCustomEvent('OnBasketChange'); // Обновляем корзину

                showPopupCart(pid, img);

            },
            error: function (xhr, ajaxOptions, thrownError) {
                // alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });
});


jQuery(document).on('click', '.js-reg-excursion button[type="submit"]', function (e) {
    if (jQuery('.js-reg-excursion').find('.js-reg-excursion-agree-wrap input').prop('checked')) {
        jQuery('.js-reg-excursion').find('.js-reg-excursion-agree-wrap').removeClass('error');
        return true;
    }
    jQuery('.js-reg-excursion').find('.js-reg-excursion-agree-wrap').addClass('error');
    return false;
});


jQuery(document).on('click', '.js-smart-filter-inputs-toggle', function (e) {
    e.preventDefault();
    jQuery(this).closest('.smart-filter-parameters-box-container').toggleClass('open');
});


window.onload = function () {

    let callCustomModalBtns = document.querySelectorAll('#modal-calc-call');
    let callCustomModalBtnCalc = document.querySelector('.proektirovanie-item.modal-calc');
    let callCustomModalBtnOrder = document.querySelector('.proektirovanie-item.modal-request');
    let customModals = document.querySelectorAll('.modal-calc-content');
    let customModalsCal = document.querySelector('#modal-calc');
    let customModalsOrder = document.querySelector('#modal-request');
    let closeCustomModalBtns = document.querySelectorAll('.close-modal-screen-img-btn');
    //modal-request
    //modal-calc

    if (callCustomModalBtns) {

        callCustomModalBtns.forEach(el => {
            el.addEventListener('click', function (e) {
                e.preventDefault();
                customModals.forEach(el2 => {
                    if (el.classList.contains(el2.id)) {
                        el2.classList.add('active');
                        let addModalHere = document.querySelector('.serv-content-wrap');
                        let modalScreenMask = document.createElement('div');
                        modalScreenMask.classList.add('custom-modal-screen-mask');
                        addModalHere.style.zIndex = '100';
                        addModalHere.appendChild(modalScreenMask);
                        document.querySelector('body').style.overflow = 'hidden';
                    }
                })
            })
        });

        closeCustomModalBtns.forEach(el => {
            el.addEventListener('click', function () {
                if (el.parentElement.classList.contains('active')) {
                    el.parentElement.classList.remove('active');
                    let addModalHere = document.querySelector('.serv-content-wrap');
                    let modalScreenMask = document.querySelector('.custom-modal-screen-mask');
                    addModalHere.style.zIndex = '';
                    addModalHere.removeChild(modalScreenMask);
                    document.querySelector('body').style.overflow = '';
                }
            });
        });
    }
};


$(document).ready(function () {
    $("#formOrderProject").submit(function (e) {
        e.preventDefault();
        var form = $(this);
        var error = false;
        form.find(".success-form").text('');
        form.find(".input-field").each(function () {
            if ($(this).val() == '') {
                $(this).addClass('error-field');
                error = true;
            } else {
                $(this).removeClass('error-field');
            }
        });
        if (!error) {
            $.ajax({
                type: "POST",
                data: form.serialize(),
                url: "/ajax/orderProject.php",
                success: function (data) {
                    if (data == 1) {
                        // yaCounter30605352.reachGoal('ok-zakaz-proekt');
                        form.find(".success-form").text('Спасибо! Ваша заявка отправлена.');
                        form.find(".success-form").addClass('active');
                        form.find(".input-field, textarea").each(function () {
                            $(this).val('');
                        });
                    } else {
                        form.find(".error-form").text(data);
                        form.find(".error-form").addClass('active');
                    }
                }
            });
        }
    });

    $("#calcForm").submit(function (e) {
        e.preventDefault();
        var form = $(this);
        var orderForm = $("#formOrderProject");
        var error = false;
        form.find(".success-form").text('');
        if ($("#suqare-meters-input").val() == '') {
            $("#suqare-meters-input").addClass('error-field');
            error = true;
        } else {
            $("#suqare-meters-input").removeClass('error-field');
        }
        if (!error) {
            orderForm.find("[name=square]").val($("#suqare-meters-input").val());
            orderForm.find("[name=placing]").val($("#equipPrice").data('price'));
            orderForm.find("[name=tech]").val($("#techPrice").data('price'));
            orderForm.find("[name=design]").val($("#designPrice").data('price'));
            orderForm.find("[name=total]").val($("#calcTotal").data('price'));
            $('#modal-calc').removeClass("active");
            $('#modal-request').addClass("active");
        }
    });

    $("#suqare-meters-input").keyup(function () {
        var square = parseFloat($(this).val());
        var isEquip = $("#equipment-placing").prop('checked');
        var isTech = $("#engineering-design").prop('checked');
        var isDesign = $("#design-project").prop('checked');
        var oldTotal = parseFloat($("#calcTotal").data('price'));
        if (!isEquip && !isTech && !isDesign) {
            //$("#calcError").text("Пожалуйста, поставьте хотя бы одну галочку!");
            $("#calcTotal").data('price', 0).text(numberWithSpaces(0) + ' рублей');
        } else {
            $("#calcError").text("");
            var equip = isEquip ? getEquipPrice(square) : 0;
            var tech = isTech ? getTechPrice(square) : 0;
            var design = isDesign ? getDesignPrice(square) : 0;
            $("#equipPrice").data('price', equip).text(numberWithSpaces(equip) + ' рублей');
            $("#techPrice").data('price', tech).text(numberWithSpaces(tech) + ' рублей');
            $("#designPrice").data('price', design).text(numberWithSpaces(design) + ' рублей');
            var totalPrice = equip + tech + design;
            $("#calcTotal").data('price', totalPrice).text(numberWithSpaces(totalPrice) + ' рублей');
        }
    });

    $("#equipment-placing").change(function () {
        var square = parseFloat($("#suqare-meters-input").val());
        var price = 0;
        var tech = parseFloat($("#techPrice").data('price'));
        var design = parseFloat($("#designPrice").data('price'));
        if ($(this).prop("checked")) {
            $("#calcError").text("");
            price = getEquipPrice(square);
        } else {
            var isTech = $("#engineering-design").prop('checked');
            var isDesign = $("#design-project").prop('checked');
            if (!isTech && !isDesign) {
                //$("#calcError").text("Пожалуйста, поставьте хотя бы одну галочку!");
                $("#calcTotal").data('price', 0).text(numberWithSpaces(0) + ' рублей');
            }
        }
        $("#equipPrice").data('price', price).text(numberWithSpaces(price) + ' рублей');
        var totalPrice = price + tech + design;
        $("#calcTotal").data('price', totalPrice).text(numberWithSpaces(totalPrice) + ' рублей');
    });

    $("#engineering-design").change(function () {
        var square = parseFloat($("#suqare-meters-input").val());
        square = isNaN(square) ? 0 : square;
        var price = 0;
        var equip = parseFloat($("#equipPrice").data('price'));
        var design = parseFloat($("#designPrice").data('price'));

        if ($(this).prop("checked")) {
            $("#calcError").text("");
            price = getTechPrice(square);
        } else {
            var isEquip = $("#equipment-placing").prop('checked');
            var isDesign = $("#design-project").prop('checked');
            if (!isEquip && !isDesign) {
                //$("#calcError").text("Пожалуйста, поставьте хотя бы одну галочку!");
                $("#calcTotal").data('price', 0).text(numberWithSpaces(0) + ' рублей');
            }
        }
        $("#techPrice").data('price', price).text(numberWithSpaces(price) + ' рублей');
        var totalPrice = price + equip + design;
        $("#calcTotal").data('price', totalPrice).text(numberWithSpaces(totalPrice) + ' рублей');
    });

    $("#design-project").change(function () {
        var square = parseFloat($("#suqare-meters-input").val());
        square = isNaN(square) ? 0 : square;
        var price = 0;
        var equip = parseFloat($("#equipPrice").data('price'));
        var tech = parseFloat($("#techPrice").data('price'));
        if ($(this).prop("checked")) {
            $("#calcError").text("");
            price = getDesignPrice(square);
        } else {
            var isEquip = $("#equipment-placing").prop('checked');
            var isTech = $("#engineering-design").prop('checked');
            if (!isEquip && !isTech) {
                //$("#calcError").text("Пожалуйста, поставьте хотя бы одну галочку!");
                $("#calcTotal").data('price', 0).text(numberWithSpaces(0) + ' рублей');
            }
        }
        $("#designPrice").data('price', price).text(numberWithSpaces(price) + ' рублей');
        var totalPrice = price + equip + tech;
        $("#calcTotal").data('price', totalPrice).text(numberWithSpaces(totalPrice) + ' рублей');
    });

});

function numberWithSpaces(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
}

function getEquipPrice(square) {
    var price = 0;
    if (square > 0 && square < 100) {
        price = 5000;
    } else if (square > 99 && square < 200) {
        price = 10000;
    } else if (square > 199 && square < 500) {
        price = 15000;
    } else if (square > 499) {
        price = 20000;
    }
    return price;
}

function getTechPrice(square) {
    var price = square * 150;
    price = price < 20000 ? 20000 : price;
    return price;
}

function getDesignPrice(square) {
    var price = square * 1200;
    price = price < 50000 ? 50000 : price;
    return price;
}








